<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이항옵션가격결정모형 - 파생상품론 시뮬레이터</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=Noto+Serif+KR:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            color: #667eea;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button">← 메인으로 돌아가기</a>
    
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        const BinomialOptionCalculator = () => {
          const [optionType, setOptionType] = useState('call');
          const [exerciseType, setExerciseType] = useState('european');
          const [spotPrice, setSpotPrice] = useState('');
          const [strikePrice, setStrikePrice] = useState('');
          const [upFactor, setUpFactor] = useState('');
          const [downFactor, setDownFactor] = useState('');
          const [riskFreeRate, setRiskFreeRate] = useState('');
          const [periods, setPeriods] = useState('2');
          const [result, setResult] = useState(null);
          const canvasRef = useRef(null);

          const calculateBinomialTree = (S0, K, u, d, r, n, isCall, isEuropean) => {
            const stockTree = Array(n + 1).fill(null).map(() => []);
            for (let i = 0; i <= n; i++) {
              for (let j = 0; j <= i; j++) {
                const price = S0 * Math.pow(u, i - j) * Math.pow(d, j);
                stockTree[i].push(price);
              }
            }

            const p = (Math.exp(r) - d) / (u - d);
            const optionTree = Array(n + 1).fill(null).map(() => []);
            
            for (let j = 0; j <= n; j++) {
              const ST = stockTree[n][j];
              if (isCall) {
                optionTree[n][j] = Math.max(ST - K, 0);
              } else {
                optionTree[n][j] = Math.max(K - ST, 0);
              }
            }

            const earlyExercise = Array(n + 1).fill(null).map(() => []);

            for (let i = n - 1; i >= 0; i--) {
              for (let j = 0; j <= i; j++) {
                const holdValue = Math.exp(-r) * (p * optionTree[i + 1][j] + (1 - p) * optionTree[i + 1][j + 1]);
                
                if (isEuropean) {
                  optionTree[i][j] = holdValue;
                  earlyExercise[i][j] = false;
                } else {
                  const ST = stockTree[i][j];
                  const exerciseValue = isCall ? Math.max(ST - K, 0) : Math.max(K - ST, 0);
                  
                  if (exerciseValue > holdValue) {
                    optionTree[i][j] = exerciseValue;
                    earlyExercise[i][j] = true;
                  } else {
                    optionTree[i][j] = holdValue;
                    earlyExercise[i][j] = false;
                  }
                }
              }
            }

            return { stockTree, optionTree, riskNeutralProb: p, earlyExercise };
          };

          const calculateOption = () => {
            const S0 = parseFloat(spotPrice);
            const K = parseFloat(strikePrice);
            const u = parseFloat(upFactor);
            const d = parseFloat(downFactor);
            const r = parseFloat(riskFreeRate) / 100;
            const n = parseInt(periods);

            if (isNaN(S0) || isNaN(K) || isNaN(u) || isNaN(d) || isNaN(r) || isNaN(n)) {
              alert('모든 값을 올바르게 입력해주세요.');
              return;
            }

            if (u <= 1 || d >= 1 || d >= u) {
              alert('상승률(u)은 1보다 크고, 하락률(d)은 1보다 작아야 하며, u > d 이어야 합니다.');
              return;
            }

            const calculated = calculateBinomialTree(
              S0, K, u, d, r, n,
              optionType === 'call',
              exerciseType === 'european'
            );

            setResult({
              ...calculated,
              inputs: { S0, K, u, d, r: r * 100, n, optionType, exerciseType }
            });
          };

          const resetForm = () => {
            setSpotPrice('');
            setStrikePrice('');
            setUpFactor('');
            setDownFactor('');
            setRiskFreeRate('');
            setPeriods('2');
            setResult(null);
          };

          // Canvas 그리기
          useEffect(() => {
            if (!result || !canvasRef.current) return;

            const canvas = canvasRef.current;
            const ctx = canvas.getContext('2d');
            const n = result.inputs.n;

            const baseWidth = 800;
            const baseHeight = 400;
            canvas.width = baseWidth;
            canvas.height = baseHeight;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const padding = 40;
            const width = baseWidth - 2 * padding;
            const height = baseHeight - 2 * padding;
            const dx = width / n;
            const nodeRadius = 25;

            ctx.font = '11px Noto Sans KR, sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            // 선 그리기
            ctx.strokeStyle = '#CBD5E1';
            ctx.lineWidth = 2;

            for (let i = 0; i < n; i++) {
              const x1 = padding + i * dx;
              const nodeCount = i + 1;
              const dy = height / nodeCount;

              for (let j = 0; j <= i; j++) {
                const y1 = padding + j * dy + dy / 2;
                const x2 = padding + (i + 1) * dx;
                const nodeCount2 = i + 2;
                const dy2 = height / nodeCount2;
                const y2_up = padding + j * dy2 + dy2 / 2;
                const y2_down = padding + (j + 1) * dy2 + dy2 / 2;

                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2_up);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2_down);
                ctx.stroke();
              }
            }

            // 노드 그리기
            for (let i = 0; i <= n; i++) {
              const x = padding + i * dx;
              const nodeCount = i + 1;
              const dy = height / nodeCount;

              for (let j = 0; j <= i; j++) {
                const y = padding + j * dy + dy / 2;
                const stockPrice = result.stockTree[i][j];
                const optionValue = result.optionTree[i][j];
                const isEarlyExercise = result.earlyExercise[i] && result.earlyExercise[i][j];
                const optionLabel = result.inputs.optionType === 'call' ? 'C' : 'P';

                ctx.beginPath();
                ctx.arc(x, y, nodeRadius, 0, 2 * Math.PI);
                
                if (isEarlyExercise) {
                  ctx.fillStyle = '#FEF3C7';
                  ctx.strokeStyle = '#F59E0B';
                } else {
                  ctx.fillStyle = '#EFF6FF';
                  ctx.strokeStyle = '#3B82F6';
                }
                
                ctx.lineWidth = 2;
                ctx.fill();
                ctx.stroke();

                ctx.fillStyle = '#1E40AF';
                ctx.font = 'bold 10px Noto Sans KR, sans-serif';
                ctx.fillText(`S=${stockPrice.toFixed(1)}`, x, y - 8);

                ctx.fillStyle = isEarlyExercise ? '#D97706' : '#059669';
                ctx.font = '10px Noto Sans KR, sans-serif';
                ctx.fillText(`${optionLabel}=${optionValue.toFixed(1)}`, x, y + 8);
              }
            }
          }, [result]);

          return (
            <div className="w-full max-w-7xl mx-auto p-6 bg-white rounded-lg shadow-lg mt-20 font-sans">
              <div className="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-3 rounded-t-lg -m-6 mb-6">
                <h2 className="text-lg font-bold font-serif">이항옵션가격결정모형 계산기</h2>
                <p className="text-blue-100 text-xs mt-0.5">Binomial Option Pricing Model</p>
              </div>

              <div className="grid grid-cols-5 gap-6">
                <div className="col-span-1 space-y-4">
                  <h3 className="text-lg font-bold text-gray-800 border-b-2 border-blue-300 pb-2 font-serif">입력 파라미터</h3>

                  <div className="space-y-3">
                    <div>
                      <label className="block text-xs font-medium mb-1 text-gray-700">옵션 유형</label>
                      <div className="space-y-1.5">
                        <label className="flex items-center cursor-pointer px-2 py-1.5 rounded bg-white border border-blue-300 text-xs">
                          <input type="radio" value="call" checked={optionType === 'call'} onChange={(e) => setOptionType(e.target.value)} className="mr-2 w-3 h-3" />
                          <span>콜 (Call)</span>
                        </label>
                        <label className="flex items-center cursor-pointer px-2 py-1.5 rounded bg-white border border-blue-300 text-xs">
                          <input type="radio" value="put" checked={optionType === 'put'} onChange={(e) => setOptionType(e.target.value)} className="mr-2 w-3 h-3" />
                          <span>풋 (Put)</span>
                        </label>
                      </div>
                    </div>

                    <div>
                      <label className="block text-xs font-medium mb-1 text-gray-700">행사 유형</label>
                      <div className="space-y-1.5">
                        <label className="flex items-center cursor-pointer px-2 py-1.5 rounded bg-white border border-blue-300 text-xs">
                          <input type="radio" value="european" checked={exerciseType === 'european'} onChange={(e) => setExerciseType(e.target.value)} className="mr-2 w-3 h-3" />
                          <span>유럽형</span>
                        </label>
                        <label className="flex items-center cursor-pointer px-2 py-1.5 rounded bg-white border border-blue-300 text-xs">
                          <input type="radio" value="american" checked={exerciseType === 'american'} onChange={(e) => setExerciseType(e.target.value)} className="mr-2 w-3 h-3" />
                          <span>미국형</span>
                        </label>
                      </div>
                    </div>

                    <div>
                      <label className="block text-xs font-medium mb-1 text-gray-700">현재 주가 (S₀)</label>
                      <input type="number" step="0.01" value={spotPrice} onChange={(e) => setSpotPrice(e.target.value)} placeholder="예: 100" className="w-full px-3 py-1.5 border border-gray-300 rounded text-sm" />
                    </div>

                    <div>
                      <label className="block text-xs font-medium mb-1 text-gray-700">행사가격 (K)</label>
                      <input type="number" step="0.01" value={strikePrice} onChange={(e) => setStrikePrice(e.target.value)} placeholder="예: 100" className="w-full px-3 py-1.5 border border-gray-300 rounded text-sm" />
                    </div>

                    <div>
                      <label className="block text-xs font-medium mb-1 text-gray-700">상승률 (u)</label>
                      <input type="number" step="0.01" value={upFactor} onChange={(e) => setUpFactor(e.target.value)} placeholder="예: 1.2" className="w-full px-3 py-1.5 border border-gray-300 rounded text-sm" />
                    </div>

                    <div>
                      <label className="block text-xs font-medium mb-1 text-gray-700">하락률 (d)</label>
                      <input type="number" step="0.01" value={downFactor} onChange={(e) => setDownFactor(e.target.value)} placeholder="예: 0.8" className="w-full px-3 py-1.5 border border-gray-300 rounded text-sm" />
                    </div>

                    <div>
                      <label className="block text-xs font-medium mb-1 text-gray-700">무위험이자율 (r, %)</label>
                      <input type="number" step="0.01" value={riskFreeRate} onChange={(e) => setRiskFreeRate(e.target.value)} placeholder="예: 5" className="w-full px-3 py-1.5 border border-gray-300 rounded text-sm" />
                    </div>

                    <div>
                      <label className="block text-xs font-medium mb-1 text-gray-700">기간 수 (n)</label>
                      <select value={periods} onChange={(e) => setPeriods(e.target.value)} className="w-full px-3 py-1.5 border border-gray-300 rounded text-sm">
                        <option value="1">1단계</option>
                        <option value="2">2단계</option>
                        <option value="3">3단계</option>
                      </select>
                    </div>
                  </div>

                  <div className="flex gap-2 pt-2">
                    <button onClick={calculateOption} className="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 font-semibold text-sm">계산</button>
                    <button onClick={resetForm} className="flex-1 bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 font-semibold text-sm">초기화</button>
                  </div>
                </div>

                <div className="col-span-4 space-y-4">
                  <h3 className="text-lg font-bold text-gray-800 border-b-2 border-blue-300 pb-2 font-serif">계산 결과</h3>

                  {result ? (
                    <>
                      <div className="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border-2 border-blue-300">
                        <p className="text-xs text-gray-600 mb-1">{result.inputs.optionType === 'call' ? '콜' : '풋'} 옵션 ({result.inputs.exerciseType === 'european' ? '유럽형' : '미국형'}) 가격</p>
                        <p className="text-3xl font-bold text-blue-600">{result.optionTree[0][0].toFixed(4)}</p>
                      </div>

                      <div className="p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-300">
                        <h4 className="text-sm font-bold mb-2 text-green-800 font-serif">위험중립확률 (p)</h4>
                        <p className="text-2xl font-bold text-green-600">p = {result.riskNeutralProb.toFixed(4)}</p>
                      </div>

                      <div className="p-4 bg-white rounded-lg border-2 border-blue-200">
                        <h4 className="text-sm font-bold mb-3 text-blue-800 font-serif">이항트리 시각화</h4>
                        <div className="overflow-auto border rounded">
                          <canvas ref={canvasRef} />
                        </div>
                      </div>
                    </>
                  ) : (
                    <div className="h-full flex items-center justify-center p-8 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300">
                      <p className="text-sm text-gray-500">왼쪽에서 입력값을 입력하고 계산하기 버튼을 눌러주세요</p>
                    </div>
                  )}
                </div>
              </div>
            </div>
          );
        };
        
        ReactDOM.render(<BinomialOptionCalculator />, document.getElementById('root'));
    </script>
</body>
</html>
